<!DOCTYPE html>
<html>
<head>
	<title>Teste</title>
</head>
	<script type='text/javascript'>
		var Producao = function(_estado, _prod, _isInicial){
			this._estado = _estado;
			this._prod = _prod;
			this._isInicial = _isInicial;
		}

		function teste(){
			//var _prod0 = new Producao('J', 'aABcD', true);
			//var _prod1 = new Producao('J', 'aBcA', true);
			//var _prod2 = new Producao('J', 'bCc', true);
			//var _prod3 = new Producao('A', 'bAbD', false);
			//var _prod4 = new Producao('A', 'bb', false);
			//var _prod5 = new Producao('A', '&', false);
			//var _prod6 = new Producao('B', 'bDaA', false);
			//var _prod7 = new Producao('B', 'bBBa', false);
			//var _prod8 = new Producao('B', 'bDba', false);
			//var _prod9 = new Producao('B', 'ba', false);
			//var _prod10 = new Producao('B', 'b', false);
			//var _prod11 = new Producao('D', 'bB', false);
			//var _prod12 = new Producao('D', '&', false);
			
			//var _producoes = [_prod0, _prod1, _prod2, _prod3, _prod4, _prod5, _prod6, _prod7, _prod8, _prod9, _prod10, _prod11, _prod12];
			
			var _prod0 = new Producao('B', 'aBCcC', true);
			var _prod1 = new Producao('B', 'ac', true);
			var _prod2 = new Producao('C', 'ab', false);
			var _prod3 = new Producao('C', '&', false);

			var _producoes = [_prod0, _prod1, _prod2, _prod3];
			removeEstadosVazios(_producoes);
		}

		function removeEstadosVazios(_producoes){
			// Mostra no console as produções antes de eliminar vazios
			console.log('Procuções antes de eliminar os vazios: ');
			imprime(_producoes);

			var _estadosComVazio = [];
			// Armazena os _estados com vazio em um array auxiliar
			for(var i = 0, j = 0; i < _producoes.length; i++){
				if (_producoes[i]._prod === '&') {
	            	_estadosComVazio[j] = _producoes[i]._estado;
	            	_producoes.splice(i, 1);
	            	j++;
				}
			}

			var _producoesAux = [];
			// Gera novas produções onde contém vazio, e armazena no array de produções auxiliares
			for(var i = 0; i < _producoes.length; i++){
				for (var j = 0 ; j < _estadosComVazio.length; j++) {
					if (_producoes[i]._prod.indexOf(_estadosComVazio[j]) > -1) {
						// Se possuir mais de uma ocorrência, por exemplo aAbcA, entra no if para fazer diferente
						// Se possuir duas repetidas, aAAbc, entra também e vai gerar produção repetida mas no final do código uma delas é eliminada
						var _novaProd = '';
	        			if (contaOcorrencias(_producoes[i]._prod, _estadosComVazio[j]) > 1){	        				
	        				for (var k = 0; k < _producoes[i]._prod.length; k++){
	        					if (_producoes[i]._prod[k] === _estadosComVazio[j]){
	        							// Quando entra nesse if achou a posição do estado, então vai criar uma produção sem o caractere dessa posição
	        							for (var l = 0; l < _producoes[i]._prod.length; l++){
	        								if (k === l){
	        									continue;
	        								}
    	    								_novaProd += _producoes[i]._prod[l];
        								}
		        						_producoesAux.push(new Producao(_producoes[i]._estado, _novaProd, _producoes[i]._isInicial));
		        						_novaProd = '';
	    	    				}
	        				}
	        			}
        				
        				// Geral - Todas as produções são geradas aqui, com excessão quando entra no IF acima que gera algumas produções a mais
        				// Tira todas as ocorrências dos estados com vazio.
        				_novaProd = '';
        				for (var k = 0; k < _producoes[i]._prod.length; k++){
	        				if (_producoes[i]._prod[k] !== _estadosComVazio[j]){
	        					_novaProd += _producoes[i]._prod[k];
	        				}
        				}
        				_producoesAux.push(new Producao(_producoes[i]._estado, _novaProd, _producoes[i]._isInicial));
	            	}
				}
			}

			// Coloca as novas produções criada no array auxiliar, passando para o array principal.			
			if (_producoesAux.length > 0){
				for (var i = 0; i < _producoesAux.length; i++){
					_producoes.push(_producoesAux[i]);
				}
				// Limpa o array auxiliar
				_producoesAux.splice(0, _producoesAux.length - 1);
			}

			// Remove possíveis produções que ficarão repetidas
			for (var i = 0; i < _producoes.length; i++){
				for (var j = i + 1; j < _producoes.length; j++){
					if (_producoes[i]._estado === _producoes[j]._estado && _producoes[i]._prod === _producoes[j]._prod){
						_producoes.splice(j, 1);
					}
				}
			}

			// Mostra no console as produções após eliminar vazios
			console.log('Procuções após eliminar os vazios: ');
			imprime(_producoes);

		}

		function contaOcorrencias(_prod, _estado){			
			return (_prod.length - (_prod.split(_estado).join('').length));
		}

		function imprime(_producoes){
			for (var i = 0; i < _producoes.length; i++){
				console.log(_producoes[i]._estado + ' ' + _producoes[i]._prod + ' ' + _producoes[i]._isInicial);			
			}
		}
	</script>
<body>
	<input type='submit' name='asçdjaslçjdasljda' onclick='teste();'>
</body>
</html>
